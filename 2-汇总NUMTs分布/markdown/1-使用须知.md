# NUMTs 多样本聚类分析工具

## 脚本功能

`1-NUMTs-多样本聚类.py` 是用于分析多个样本中共享的 NUMTs (Nuclear Mitochondrial DNA) 聚类的工具。

### 主要功能：
- **跨样本聚类分析**：将来自不同样本的 NUMT 位点按染色体和基因组位置进行聚类
- **位置合并**：使用 1000bp 的最大间隔合并相邻的 NUMT 位点
- **统计汇总**：为每个合并后的聚类提供详细的统计信息
- **共享位点识别**：识别在多个个体中出现的共同 NUMT 插入位点

---

## 输入文件

### 期待的输入文件格式
- **文件名**：通常为多个样本的 `*.breakpointINPUT.tsv` 文件合并后的结果
- **格式**：无表头的 TSV 文件（制表符分隔）
- **列数**：8 列

### 输入文件各列解读

| 列号 | 列名 | 数据类型 | 说明 | 示例 |
|------|------|----------|------|------|
| 1 | sampleID | 字符串 | 样本标识符 | Y21100000492606.deduped |
| 2 | Cluster_No | 整数 | 该样本中的聚类读段数量 | 2, 6, 16 |
| 3 | disFile | 字符串 | discordant reads 文件路径 | /path/to/sample.mt.disc.sam |
| 4 | splitFile | 字符串 | split reads 文件路径 | /path/to/sample.mt.split.sam |
| 5 | wgsBAM | 字符串 | 全基因组测序 BAM 文件路径 | /path/to/sample.bam |
| 6 | chr | 字符串/整数 | 染色体编号 | 10, 11, 17, X, Y |
| 7 | start | 整数 | NUMT 区域起始位置（bp） | 42398123 |
| 8 | end | 整数 | NUMT 区域结束位置（bp） | 42399249 |

### 输入文件示例
```tsv
Y21100000492606.deduped	2	/home/user/sample.mt.disc.sam	/home/user/sample.mt.split.sam	/home/user/sample.bam	10	42398123	42399249
Y21100000492606.deduped	6	/home/user/sample.mt.disc.sam	/home/user/sample.mt.split.sam	/home/user/sample.bam	11	49882868	49884072
```

---

## 输出文件

脚本会生成两个输出文件：

### 1. `<输入文件名>.allCluster.tsv`
详细的聚类分组结果

#### 输出文件各列解读

| 列名 | 数据类型 | 说明 | 示例 |
|------|----------|------|------|
| GroupID | 整数 | 聚类组内部编号 | 0, 1, 2 |
| Index | 整数 | 组内位点索引 | 0, 1, 2 |
| POS | 整数 | NUMT 位点的中心位置 | 42398686 |
| CHR | 字符串/整数 | 染色体编号 | 10, 11, 17 |
| mergedClusterID | 字符串 | 合并聚类的唯一标识符 | 0_10, 1_11 |

### 2. `<输入文件名>.allCluster.sum.tsv`
聚类的统计汇总信息

#### 汇总文件各列解读

| 列名 | 数据类型 | 说明 | 示例 |
|------|----------|------|------|
| mergedClusterID | 字符串 | 合并聚类的唯一标识符 | 0_10, 1_11 |
| GroupID | 整数 | 该聚类包含的组数量 | 1 |
| Index | 整数 | 该聚类包含的索引数量 | 1 |
| POS | 整数 | 该聚类包含的位点数量 | 1 |
| CHR | 整数 | 该聚类包含的染色体数量 | 1 |
| min | 整数 | 聚类内最小基因组位置 | 42398686 |
| max | 整数 | 聚类内最大基因组位置 | 42398686 |

---

## 使用方法

### 1. 准备输入数据

#### 单个样本
如果只有一个样本，直接使用该样本的 `breakpointINPUT.tsv` 文件：

```bash
python3 groupNumtCluster_fromMultipleSamples.py sample1.breakpointINPUT.tsv
```

#### 多个样本
如果有多个样本，需要先合并所有样本的 `breakpointINPUT.tsv` 文件：

```bash
# 合并多个样本的数据
cat sample1.breakpointINPUT.tsv sample2.breakpointINPUT.tsv sample3.breakpointINPUT.tsv > merged_samples.tsv

# 运行聚类分析
python3 groupNumtCluster_fromMultipleSamples.py merged_samples.tsv
```

### 2. 完整使用示例

```bash
# 切换到工作目录
cd /mnt/f/OneDrive/文档（科研）/脚本/Download/15-NUMTs-detector-V2/2-汇总NUMTs分布/

# 运行脚本
python3 groupNumtCluster_fromMultipleSamples.py Y21100000492606.deduped.mt.disc.sam.breakpointINPUT.tsv

# 查看输出文件
ls -la *.allCluster*
```

### 3. 输出文件说明

运行完成后，会在同一目录下生成：
- `Y21100000492606.deduped.mt.disc.sam.breakpointINPUT.tsv.allCluster.tsv` - 详细聚类结果
- `Y21100000492606.deduped.mt.disc.sam.breakpointINPUT.tsv.allCluster.sum.tsv` - 聚类统计汇总

---

## 重要参数

- **最大间隔距离**：1000bp（硬编码在脚本中）
  - 相距小于 1000bp 的 NUMT 位点会被合并为同一聚类
  - 如需修改，请编辑脚本中的 `maxgap=1000` 参数

---

## 注意事项

1. **文件格式要求**：输入文件必须是无表头的 TSV 格式，且严格按照 8 列的顺序
2. **染色体命名**：支持数字染色体（1-22）和性染色体（X, Y）
3. **内存使用**：对于大量样本，建议确保有足够的内存
4. **Python 依赖**：需要 pandas、numpy 等库

---

## 版本信息

- **脚本版本**：适配新版 NUMTs-detector-V2
- **兼容性**：适用于 pandas >= 1.3.0
- **更新日期**：2025年10月

---

## 故障排除

### 常见问题

1. **pandas.DataFrame.append 错误**
   - 解决方案：使用较新版本的 pandas，脚本已修复此兼容性问题

2. **列名不匹配错误**
   - 解决方案：确保输入文件格式正确，无额外的表头行

3. **空结果文件**
   - 检查输入文件是否包含有效的 NUMT 数据
   - 确认染色体名称格式正确